// Backbone with Benefits 0.1.0 (https://github.com/javan/backbone-with-benefits)
// Copyright (c) 2014 Javan Makhmali <javan@javan.us> (http://javan.us)
// MIT license (http://opensource.org/licenses/MIT)
(function(){var a,b,c,d,e,f,g,h;"undefined"!=typeof exports&&null!==exports&&!function(){return this._=require("underscore"),exports.Backbone=this.Backbone=require("backbone")}(),Backbone.Benefits={db:{},register:function(a){this.db=a}},_.extend(Backbone.Model,{hasMany:function(a,f){var h,i,j,k,l,m,n;return n=null!=f?f:{},k=n.foreignKey,h=n.as,m=n.through,j=n.conditions,l=n.modelName,i=n.collectionName,this.prototype[b(a)]=function(b){var f,n,o;switch(null==i&&(i=null!=l?l:a),null==j&&(j={}),o=e(this.constructor),f=c(i),!1){case!k:j[k]=this.id;break;case!h:j[""+h+"_type"]=o,j[""+h+"_id"]=this.id;break;default:k=d(o),j[k]=this.id}return n=null!=m?_(this[m]().where(j)).invoke(g(i)):f.where(j),new f.constructor(n,b)}},belongsTo:function(a,e){var f,g,h;return h=null!=e?e:{},f=h.modelName,g=h.polymorphic,this.prototype[b(a)]=function(){var b,e;switch(!1){case!g:b=this.get(""+a+"_type"),e=""+a+"_id";break;case!f:b=f,e=d(a);break;default:b=a,e=d(a)}return null!=b&&null!=e?c(b).get(this.get(e)):void 0}}}),c=function(a){var c,d,e,g,h;for(e=[a,f(a),b(f(a))],g=0,h=e.length;h>g;g++)if(d=e[g],c=Backbone.Benefits.db[d])return c},e=function(a){var b,c,d;return null!=(b=null!=(c=a.modelName)?c:a.name)?b:null!=(d=a.toString().match(/function\s*(\w+)/))?d[1]:void 0},d=function(a){return h(g(a))+"_id"},h=function(a){return a.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},a=function(a){return a.charAt(0).toUpperCase()+a.substring(1)},b=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},f=function(a){return a.replace(/([^s])$/,"$1s")},g=function(a){return a.replace(/s$/,"")}}).call(this);